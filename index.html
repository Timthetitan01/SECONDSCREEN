<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecondScreen Pro | iOS Style</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        :root {
            /* Apple System Colors (Dark Mode) */
            --bg-body: #000000;
            --ios-card: rgba(28, 28, 30, 0.65);
            --ios-card-border: rgba(255, 255, 255, 0.12);
            --ios-input: rgba(118, 118, 128, 0.24);
            --ios-blue: #0A84FF;
            --ios-green: #30D158;
            --ios-red: #FF453A;
            --ios-orange: #FF9F0A;
            --ios-yellow: #FFD60A;
            --ios-purple: #BF5AF2;
            --text-main: #FFFFFF;
            --text-sec: #EBEBF599; /* 60% White */
            --text-ter: #EBEBF54D; /* 30% White */
            
            --blur: blur(50px) saturate(180%);
            --radius: 22px; /* Apple Squircle-ish */
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg-body);
            /* macOS Big Sur style abstract mesh */
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(10, 132, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 100% 0%, rgba(191, 90, 242, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(48, 209, 88, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(10, 132, 255, 0.2) 0%, transparent 50%);
            color: var(--text-main);
            font-family: var(--font);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* macOS Style Menu Bar */
        nav {
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: rgba(20, 20, 20, 0.4);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--ios-card-border);
            z-index: 1000;
        }

        .brand { font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px; letter-spacing: -0.3px; }
        .brand i { color: var(--ios-blue); }

        .nav-actions { display: flex; gap: 10px; }

        /* iOS Buttons */
        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 99px; /* Pill shape */
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            display: flex; align-items: center; gap: 6px;
        }
        .btn:hover { background: rgba(255, 255, 255, 0.2); }
        .btn:active { transform: scale(0.94); opacity: 0.8; } /* iOS Touch feel */
        
        .btn-primary { background: var(--ios-blue); color: white; }
        .btn-primary:hover { background: #0071e3; }
        
        .btn-danger { background: rgba(255, 69, 58, 0.15); color: var(--ios-red); }
        .btn-danger:hover { background: rgba(255, 69, 58, 0.25); }

        /* Dashboard */
        #dashboard-wrapper { flex: 1; padding: 20px; overflow-y: auto; overflow-x: hidden; }

        /* Widget Card - Apple Style */
        .grid-stack-item-content {
            background: var(--ios-card) !important;
            backdrop-filter: var(--blur) !important;
            -webkit-backdrop-filter: var(--blur) !important;
            border: 1px solid var(--ios-card-border) !important;
            border-radius: var(--radius) !important;
            padding: 16px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
        }
        
        /* Edit Mode Jiggle */
        .remove-widget {
            position: absolute; top: -6px; left: -6px; width: 22px; height: 22px;
            background: #8e8e93; border: 2px solid var(--bg-body); border-radius: 50%;
            color: white; display: none; justify-content: center; align-items: center;
            font-size: 10px; cursor: pointer; z-index: 1001;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .editing .remove-widget { display: flex; animation: popIn 0.2s ease; }
        .editing .grid-stack-item-content { animation: jiggle 0.3s infinite ease-in-out; }

        @keyframes jiggle { 0% { transform: rotate(-0.5deg); } 50% { transform: rotate(0.5deg); } 100% { transform: rotate(-0.5deg); } }
        @keyframes popIn { from{ transform: scale(0); } to { transform: scale(1); }}

        /* Headers */
        .w-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; height: 16px; flex-shrink: 0; }
        .w-label { 
            font-size: 11px; 
            font-weight: 600; 
            color: var(--ios-blue); 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            display: flex; align-items: center; gap: 6px; 
        }
        .w-label i { font-size: 12px; }
        .w-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; min-height: 0; }

        /* Typography & Components */
        .time-big { font-size: 46px; font-weight: 300; letter-spacing: -1px; line-height: 1; margin: auto 0; text-align: center; font-variant-numeric: tabular-nums; }
        .date-sub { font-size: 13px; color: var(--ios-red); font-weight: 600; text-align: center; margin-bottom: auto; text-transform: uppercase; }

        /* Progress Bars (Like Health App) */
        .stat-row { margin-bottom: 10px; }
        .stat-label { font-size: 11px; color: var(--text-sec); display: flex; justify-content: space-between; margin-bottom: 4px; font-weight: 500; }
        .bar-bg { height: 6px; background: rgba(120, 120, 128, 0.2); border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); border-radius: 10px; }

        /* iOS Inputs */
        input, textarea, select {
            background: var(--ios-input);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            width: 100%;
            font-size: 13px;
            font-family: inherit;
            outline: none;
            transition: background 0.2s;
        }
        input:focus { background: rgba(118, 118, 128, 0.4); }
        
        /* Calculator (iOS Style) */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; flex: 1; align-items: end; }
        .calc-btn { 
            background: rgba(255,255,255,0.1); border: none; color: white; 
            border-radius: 50px; font-size: 16px; cursor: pointer; aspect-ratio: 1;
            display: flex; align-items: center; justify-content: center;
        }
        .calc-btn:hover { background: rgba(255,255,255,0.2); }
        .calc-btn:active { background: rgba(255,255,255,0.4); }
        .calc-orange { background: var(--ios-orange); color: white; }
        .calc-orange:hover { background: #e08900; }
        .calc-screen { text-align:right; font-size:28px; font-weight: 300; background:transparent; padding:0 5px; margin-bottom: 5px; height: 32px; letter-spacing: -0.5px; }

        /* Calendar */
        .cal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-weight: 600; font-size: 13px; color: var(--ios-red); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 11px; gap: 2px; flex: 1; align-items: center; }
        .cal-day { width: 24px; height: 24px; display:flex; align-items:center; justify-content:center; border-radius: 50%; cursor: default; margin: auto; }
        .cal-day.today { background: var(--ios-red); color: white; font-weight: 600; }
        
        /* Tasks */
        .todo-item { padding: 8px 10px; margin-bottom: 4px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 8px; }
        .todo-item i { color: var(--text-ter); }
        .todo-item.done { opacity: 0.5; }
        .todo-item.done i { color: var(--ios-blue); }

        /* Add Panel (App Library Style) */
        #add-panel {
            position: fixed; bottom: -600px; left: 0; width: 100%;
            background: rgba(28, 28, 30, 0.9); backdrop-filter: blur(40px);
            border-top: 1px solid var(--ios-card-border); padding: 30px 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px;
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 2000; border-radius: 24px 24px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        #add-panel.show { transform: translateY(-600px); }
        
        .add-card {
            background: rgba(255,255,255,0.05); 
            padding: 15px 10px; border-radius: 18px; text-align: center; cursor: pointer;
            transition: all 0.2s; display:flex; flex-direction:column; align-items:center; gap:8px;
        }
        .add-card:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        .add-icon { font-size: 24px; margin-bottom: 2px; }
        .add-label { font-size: 11px; font-weight: 500; color: var(--text-sec); }

        /* Scrollbar (Mac Style) */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); border: 2px solid transparent; background-clip: content-box; }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fa-brands fa-apple"></i> SecondScreen Pro</div>
        <div class="nav-actions">
            <button class="btn btn-primary" onclick="UI.toggleAdd(true)"><i class="fa-solid fa-plus"></i> Add</button>
            <button id="edit-btn" class="btn" onclick="Core.toggleEdit()"><i class="fa-solid fa-pen-nib"></i> Edit</button>
            <button class="btn" onclick="Core.saveLayout()"><i class="fa-solid fa-cloud"></i></button>
            <button class="btn btn-danger" onclick="Core.reset()"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </nav>

    <div id="dashboard-wrapper">
        <div class="grid-stack"></div>
    </div>

    <div id="add-panel">
        <div class="add-card" onclick="Core.createWidget('clock', 4, 2)">
            <i class="fa-regular fa-clock add-icon" style="color:var(--text-main)"></i><span class="add-label">Clock</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('weather', 3, 2)">
            <i class="fa-solid fa-cloud-sun add-icon" style="color:var(--ios-blue)"></i><span class="add-label">Weather</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('todo', 3, 4)">
            <i class="fa-solid fa-check-circle add-icon" style="color:var(--ios-orange)"></i><span class="add-label">Reminders</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('music', 3, 3)">
            <i class="fa-brands fa-spotify add-icon" style="color:#1DB954"></i><span class="add-label">Music</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('stats', 3, 3)">
            <i class="fa-solid fa-chart-simple add-icon" style="color:var(--ios-green)"></i><span class="add-label">Activity</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('calc', 3, 4)">
            <i class="fa-solid fa-calculator add-icon" style="color:var(--ios-yellow)"></i><span class="add-label">Calc</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('cal', 4, 3)">
            <i class="fa-regular fa-calendar add-icon" style="color:var(--ios-red)"></i><span class="add-label">Calendar</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('notes', 6, 3)">
            <i class="fa-solid fa-note-sticky add-icon" style="color:var(--ios-yellow)"></i><span class="add-label">Notes</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('pass', 4, 2)">
            <i class="fa-solid fa-shield-halved add-icon" style="color:var(--ios-purple)"></i><span class="add-label">Passwords</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('conv', 3, 3)">
            <i class="fa-solid fa-arrow-right-arrow-left add-icon" style="color:var(--ios-blue)"></i><span class="add-label">Convert</span>
        </div>
        <div class="add-card" onclick="Core.createWidget('stop', 3, 2)">
            <i class="fa-solid fa-stopwatch add-icon" style="color:var(--ios-orange)"></i><span class="add-label">Timer</span>
        </div>
        <div class="add-card" style="background:rgba(255,69,58,0.1)" onclick="UI.toggleAdd(false)">
            <i class="fa-solid fa-xmark add-icon" style="color:var(--ios-red)"></i><span class="add-label" style="color:var(--ios-red)">Close</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all.js"></script>
    
    <script>
        const Utils = {
            calc: (id, val) => {
                const s = document.getElementById(`scr-${id}`);
                if (val === '=') { try { s.innerText = eval(s.innerText.replace('×','*').replace('÷','/')); } catch { s.innerText = "Error"; } }
                else if (val === 'C') { s.innerText = ''; }
                else s.innerText += val;
            },
            genPass: (id) => {
                const len = document.getElementById(`rng-${id}`).value;
                const charset = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789";
                let ret = "";
                for (let i = 0; i < len; i++) ret += charset.charAt(Math.floor(Math.random() * charset.length));
                document.getElementById(`pass-${id}`).value = ret;
            },
            convert: (id) => {
                const v = parseFloat(document.getElementById(`in-${id}`).value);
                const t = document.getElementById(`mode-${id}`).value;
                const o = document.getElementById(`out-${id}`);
                if (isNaN(v)) return o.innerText = "---";
                const maps = { 'cf': [(v*9/5)+32, '°F'], 'fc': [(v-32)*5/9, '°C'], 'kl': [v*2.204, 'lbs'], 'lk': [v/2.204, 'kg'] };
                if(maps[t]) o.innerText = `${maps[t][0].toFixed(1)} ${maps[t][1]}`;
            },
            stopwatch: (id, act) => {
                const d = document.getElementById(`sw-${id}`);
                const b = document.getElementById(`btn-sw-${id}`);
                if(!window[`sw_${id}`]) window[`sw_${id}`] = { t: 0, i: null, r: false };
                let s = window[`sw_${id}`];
                if(act === 'toggle') {
                    if(s.r) { clearInterval(s.i); b.innerHTML = `Start`; b.style.color = 'var(--ios-green)'; b.style.background = 'rgba(48, 209, 88, 0.2)'; } 
                    else { 
                        const start = Date.now() - s.t; 
                        s.i = setInterval(() => { s.t = Date.now() - start; d.innerText = new Date(s.t).toISOString().slice(14, 22); }, 10); 
                        b.innerHTML = `Stop`; b.style.color = 'var(--ios-red)'; b.style.background = 'rgba(255, 69, 58, 0.2)';
                    }
                    s.r = !s.r;
                } else { s.t = 0; s.r = false; clearInterval(s.i); d.innerText = "00:00.00"; b.innerHTML = `Start`; b.style.color = 'var(--ios-green)'; b.style.background = 'rgba(48, 209, 88, 0.2)'; }
            }
        };

        const Core = (() => {
            let grid = null, editing = false;

            const init = () => {
                // Compact Height maintained from previous preference
                grid = GridStack.init({ column: 12, cellHeight: '85px', margin: 12, float: true, animate: true });
                loadData();
                setInterval(UI.updateTime, 1000);
                setInterval(UI.updateStats, 3000);
            };

            const toggleEdit = () => {
                editing = !editing;
                grid.enableMove(editing); grid.enableResize(editing);
                document.body.classList.toggle('editing', editing);
                document.getElementById('edit-btn').innerHTML = editing ? '<i class="fa-solid fa-check"></i> Done' : '<i class="fa-solid fa-pen-nib"></i> Edit';
            };

            const createWidget = (type, w, h, x, y, savedData) => {
                const id = 'w-' + Math.random().toString(36).substr(2, 9);
                let realType = type;
                if(type === 'tasks') realType = 'todo'; 
                if(type === 'system') realType = 'stats';
                if(type === 'timer') realType = 'stop';
                if(type === 'keygen') realType = 'pass';
                if(type === 'convert') realType = 'conv';
                if(type === 'calendar') realType = 'cal';

                const content = Templates.get(realType, id);
                const el = grid.addWidget({ w, h, x, y, content, minW: 3, minH: 2 });
                el.querySelector('.remove-widget').onclick = () => grid.removeWidget(el);
                
                if (realType === 'todo') UI.initTodo(id, savedData);
                if (realType === 'notes') UI.initNotes(id, savedData);
                if (realType === 'weather') UI.initWeather(id);
                if (realType === 'cal') UI.initCal(id);
                if (realType === 'pass') Utils.genPass(id);

                UI.toggleAdd(false);
                saveLayout();
            };

            const saveLayout = () => {
                const items = grid.getGridItems().map(el => {
                    const type = el.getAttribute('data-type');
                    let data = null;
                    if (type === 'notes') data = el.querySelector('textarea').value;
                    if (type === 'todo') data = Array.from(el.querySelectorAll('.todo-item')).map(i => ({t: i.innerText, d: i.classList.contains('done')}));
                    return { x: el.gridstackNode.x, y: el.gridstackNode.y, w: el.gridstackNode.w, h: el.gridstackNode.h, type, data };
                });
                localStorage.setItem('ss_ios_v1', JSON.stringify(items));
            };

            const loadData = () => {
                let saved = JSON.parse(localStorage.getItem('ss_ios_v1'));
                // Migration logic from previous version to keep your layout
                if(!saved) saved = JSON.parse(localStorage.getItem('ss_pro_compact'));

                if (saved) {
                    saved.forEach(s => createWidget(s.type, s.w, s.h, s.x, s.y, s.data));
                } else {
                    createWidget('clock', 4, 2, 0, 0);
                    createWidget('weather', 4, 2, 4, 0);
                    createWidget('music', 4, 2, 8, 0);
                    createWidget('todo', 4, 4, 0, 2);
                    createWidget('stats', 4, 4, 4, 2);
                    createWidget('cal', 4, 4, 8, 2);
                }
            };

            return { init, toggleEdit, createWidget, saveLayout, reset: () => { localStorage.clear(); location.reload(); } };
        })();

        const UI = {
            toggleAdd: (show) => document.getElementById('add-panel').classList.toggle('show', show),
            updateTime: () => {
                const now = new Date();
                document.querySelectorAll('.time-big').forEach(el => el.innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false}));
                document.querySelectorAll('.date-sub').forEach(el => el.innerText = now.toLocaleDateString(undefined, {weekday:'long', month:'long', day:'numeric'}));
            },
            updateStats: () => {
                const set = (cls, v) => document.querySelectorAll(cls).forEach(el => { el.style.width = v+'%'; el.closest('.stat-row').querySelector('.v-label').innerText = v+'%'; });
                set('.cpu-bar', Math.floor(Math.random() * 40) + 10);
                set('.ram-bar', Math.floor(Math.random() * 20) + 50);
                set('.net-bar', Math.floor(Math.random() * 60) + 20);
            },
            initTodo: (id, data) => {
                const list = document.getElementById(`list-${id}`);
                const add = (t, d) => {
                    const i = document.createElement('div'); i.className = `todo-item ${d?'done':''}`; i.innerHTML = `<i class="fa-regular ${d?'fa-circle-check':'fa-circle'}"></i> ${t}`;
                    i.onclick = () => { i.classList.toggle('done'); i.querySelector('i').className = `fa-regular ${i.classList.contains('done')?'fa-circle-check':'fa-circle'}`; Core.saveLayout(); };
                    i.oncontextmenu = (e) => { e.preventDefault(); i.remove(); Core.saveLayout(); };
                    list.appendChild(i);
                }
                document.getElementById(`in-${id}`).onkeypress = (e) => { if(e.key === 'Enter' && e.target.value) { add(e.target.value, false); e.target.value=''; Core.saveLayout(); } };
                if(data) data.forEach(d => add(d.t, d.d));
            },
            initNotes: (id, data) => { const el = document.getElementById(`nt-${id}`); if(data) el.value = data; el.oninput = () => Core.saveLayout(); },
            initWeather: (id) => {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`)
                    .then(r=>r.json()).then(d => {
                        const el = document.getElementById(`temp-${id}`); if(el) el.innerText = Math.round(d.current_weather.temperature) + '°';
                    });
                }, () => {}, {timeout:5000});
            },
            initCal: (id) => {
                const con = document.getElementById(`cal-${id}`);
                const d = new Date();
                document.getElementById(`cal-h-${id}`).innerText = d.toLocaleDateString(undefined, {month:'long', year:'numeric'});
                const days = new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
                const start = new Date(d.getFullYear(), d.getMonth(), 1).getDay();
                let h = '';
                ['S','M','T','W','T','F','S'].forEach(dy => h+=`<div style="color:var(--text-ter)">${dy.charAt(0)}</div>`);
                for(let i=0; i<start; i++) h+=`<div></div>`;
                for(let i=1; i<=days; i++) h+=`<div class="cal-day ${i===new Date().getDate()?'today':''}">${i}</div>`;
                con.innerHTML = h;
            }
        };

        const Templates = {
            get: (type, id) => {
                const wrap = (l, c) => `<div class="remove-widget">✕</div><div class="w-header" data-type="${type}"><span class="w-label">${l}</span></div><div class="w-content" data-type="${type}">${c}</div>`;
                
                const map = {
                    clock: wrap('City', `<div class="time-big">00:00</div><div class="date-sub">Loading...</div>`),
                    weather: wrap('Weather', `<div style="display:flex;align-items:center;justify-content:center;gap:15px;height:100%"><i class="fa-solid fa-cloud-sun" style="font-size:32px;color:var(--text-main)"></i><div><div id="temp-${id}" style="font-size:28px;font-weight:400">--°</div><div style="font-size:11px;color:var(--text-sec)">Mostly Clear</div></div></div>`),
                    todo: wrap('Reminders', `<div style="display:flex;gap:5px;margin-bottom:6px"><input id="in-${id}" placeholder="New Reminder..."><button class="btn" style="padding:0 10px;background:var(--ios-blue)" onclick="document.getElementById('list-${id}').innerHTML='';Core.saveLayout()"><i class="fa-solid fa-trash"></i></button></div><div id="list-${id}" style="flex:1;overflow-y:auto"></div>`),
                    music: wrap('Music', `<div style="text-align:center;display:flex;flex-direction:column;justify-content:center;height:100%"><div style="display:flex;align-items:center;gap:10px;margin-bottom:10px"><div style="width:40px;height:40px;background:#333;border-radius:6px;display:flex;align-items:center;justify-content:center"><i class="fa-brands fa-spotify" style="color:#1DB954;font-size:24px"></i></div><div style="text-align:left"><div style="font-weight:600;font-size:12px">Not Playing</div><div style="font-size:10px;color:var(--text-sec)">iPhone</div></div></div><div style="display:flex;justify-content:center;gap:20px;font-size:20px;color:var(--text-main)"><i class="fa-solid fa-backward-step"></i><i class="fa-solid fa-play"></i><i class="fa-solid fa-forward-step"></i></div></div>`),
                    stats: wrap('Activity', `<div class="stat-row"><div class="stat-label">CPU <span class="v-label">0%</span></div><div class="bar-bg"><div class="bar-fill cpu-bar" style="width:0%;background:var(--ios-red)"></div></div></div><div class="stat-row"><div class="stat-label">RAM <span class="v-label">0%</span></div><div class="bar-bg"><div class="bar-fill ram-bar" style="width:0%;background:var(--ios-green)"></div></div></div><div class="stat-row"><div class="stat-label">NET <span class="v-label">0%</span></div><div class="bar-bg"><div class="bar-fill net-bar" style="width:0%;background:var(--ios-blue)"></div></div></div>`),
                    calc: wrap('Calculator', `<div id="scr-${id}" class="calc-screen">0</div><div class="calc-grid">${['C','÷','×','7','8','9','4','5','6','1','2','3','0','.','='].map(k=>`<button class="calc-btn ${['C','÷','×','='].includes(k)?'calc-orange':''}" onclick="Utils.calc('${id}','${k}')">${k}</button>`).join('')}</div>`),
                    cal: wrap('Calendar', `<div id="cal-h-${id}" class="cal-head"></div><div id="cal-${id}" class="cal-grid"></div>`),
                    notes: wrap('Notes', `<textarea id="nt-${id}" style="flex:1;resize:none;background:transparent;border:none;padding:0;font-family:inherit;font-size:14px;line-height:1.4" placeholder="New Note..."></textarea>`),
                    pass: wrap('Passwords', `<input id="pass-${id}" readonly style="font-family:monospace;text-align:center;margin-bottom:8px;color:var(--ios-green);font-size:14px;letter-spacing:1px"><div style="display:flex;align-items:center;gap:5px;font-size:11px;margin-bottom:8px"><input type="range" id="rng-${id}" min="8" max="24" value="12" style="flex:1" oninput="Utils.genPass('${id}')"></div><button class="btn btn-primary" style="width:100%;justify-content:center;background:var(--ios-card-border)" onclick="Utils.genPass('${id}')">Generate</button>`),
                    conv: wrap('Convert', `<div style="display:flex;gap:5px;margin-bottom:8px"><input type="number" id="in-${id}" placeholder="Value" oninput="Utils.convert('${id}')"><div id="out-${id}" style="flex:1;display:flex;align-items:center;justify-content:flex-end;font-weight:600;font-size:14px">--</div></div><select id="mode-${id}" onchange="Utils.convert('${id}')"><option value="cf">°C to °F</option><option value="fc">°F to °C</option><option value="kl">Kg to Lbs</option></select>`),
                    stop: wrap('Timer', `<div id="sw-${id}" style="font-size:32px;font-weight:200;text-align:center;margin:auto 0;font-variant-numeric:tabular-nums">00:00.00</div><div style="display:flex;gap:5px"><button id="btn-sw-${id}" class="btn" style="flex:1;justify-content:center;background:rgba(48,209,88,0.2);color:var(--ios-green);height:30px" onclick="Utils.stopwatch('${id}','toggle')">Start</button><button class="btn" style="justify-content:center;background:rgba(142,142,147,0.2);color:white;height:30px" onclick="Utils.stopwatch('${id}','reset')">Reset</button></div>`)
                };
                return map[type] || `<div>Error: ${type}</div>`;
            }
        };

        window.onload = Core.init;
    </script>
</body>
</html>
