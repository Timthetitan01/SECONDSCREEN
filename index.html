<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecondScreen Pro | Ultra Dashboard</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: rgba(22, 22, 24, 0.7);
            --card-border: rgba(255, 255, 255, 0.12);
            --accent-blue: #0A84FF;
            --accent-green: #1DB954;
            --accent-red: #FF3B30;
            --text-main: #FFFFFF;
            --text-secondary: #8E8E93;
            --glass-blur: blur(45px) saturate(210%);
            --transition-smooth: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 10% 10%, #151517 0%, transparent 35%),
                radial-gradient(circle at 90% 90%, #0d0d0e 0%, transparent 35%);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        nav {
            height: 75px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; z-index: 1000; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(20px); border-bottom: 1px solid var(--card-border);
        }

        .logo { font-size: 22px; font-weight: 700; letter-spacing: -0.8px; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--accent-blue); }

        .btn {
            background: rgba(255, 255, 255, 0.08); border: 1px solid var(--card-border);
            color: white; padding: 10px 22px; border-radius: 12px; font-size: 14px;
            font-weight: 600; cursor: pointer; transition: var(--transition-smooth);
            display: flex; align-items: center; gap: 10px;
        }

        .btn-primary { background: var(--accent-blue); border: none; }
        .btn-danger { background: #2c0e0e; color: var(--accent-red); }

        #dashboard-wrapper { flex: 1; padding: 30px; overflow-y: auto; width: 100%; }

        .grid-stack-item-content {
            background: var(--card-bg) !important;
            backdrop-filter: var(--glass-blur) !important;
            border: 1px solid var(--card-border) !important;
            border-radius: 28px !important;
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow: visible !important;
        }

        .remove-widget {
            position: absolute; top: -12px; right: -12px; width: 32px; height: 32px;
            background: var(--accent-red); border: 3px solid #000; border-radius: 50%;
            color: white; display: none; justify-content: center; align-items: center;
            font-size: 14px; font-weight: 900; cursor: pointer; z-index: 1001;
        }

        .editing .remove-widget { display: flex; }
        .editing .grid-stack-item-content { border: 2px solid var(--accent-blue) !important; animation: wiggle 0.3s infinite ease-in-out; }

        @keyframes wiggle {
            0% { transform: rotate(-0.5deg); }
            50% { transform: rotate(0.5deg); }
            100% { transform: rotate(-0.5deg); }
        }

        .w-label { font-size: 10px; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 1.8px; margin-bottom: 12px; font-weight: 800; display: block; }
        .time-display { font-size: 58px; font-weight: 800; letter-spacing: -3px; line-height: 1; margin: 10px 0; }
        .date-display { font-size: 16px; color: var(--text-secondary); }

        /* Generic UI Elements for Widgets */
        input, select { background: rgba(255,255,255,0.05); border: 1px solid var(--card-border); color: white; padding: 10px; border-radius: 8px; margin-bottom: 5px; outline: none; width: 100%; }
        .widget-val { font-size: 32px; font-weight: 800; margin: 5px 0; }

        /* Calculator Styles */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .calc-btn { background: rgba(255,255,255,0.1); border: none; color: white; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .calc-btn:hover { background: var(--accent-blue); }

        /* Calendar Styles */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 12px; }
        .cal-day-head { color: var(--accent-blue); font-weight: 800; padding-bottom: 5px; }
        .cal-today { background: var(--accent-blue); border-radius: 5px; }

        #add-panel { position: fixed; bottom: -500px; left: 0; width: 100%; background: rgba(18, 18, 20, 0.98); backdrop-filter: blur(40px); border-top: 1px solid var(--card-border); padding: 50px; display: flex; justify-content: center; gap: 20px; transition: 0.6s; z-index: 2000; flex-wrap: wrap; }
        #add-panel.show { bottom: 0; }
    </style>
</head>
<body>

    <nav>
        <div class="logo"><i class="fa-solid fa-layer-group"></i> Second<span>Screen</span> Pro</div>
        <div style="display:flex; gap:14px;">
            <button class="btn" onclick="toggleAddPanel(true)"><i class="fa fa-plus"></i> Add Widget</button>
            <button id="edit-mode-btn" class="btn" onclick="Dashboard.toggleEdit()"><i class="fa fa-pencil"></i> Customize</button>
            <button class="btn btn-primary" onclick="Dashboard.saveState()"><i class="fa fa-save"></i> Save</button>
            <button class="btn btn-danger" onclick="Dashboard.clearState()"><i class="fa fa-refresh"></i> Reset</button>
        </div>
    </nav>

    <div id="dashboard-wrapper">
        <div class="grid-stack"></div>
    </div>

    <div id="add-panel">
        <button class="btn" onclick="Dashboard.addWidget('clock', 4, 3)">Clock</button>
        <button class="btn" onclick="Dashboard.addWidget('todo', 3, 4)">To-Do</button>
        <button class="btn" onclick="Dashboard.addWidget('timer', 3, 3)">Timer</button>
        <button class="btn" onclick="Dashboard.addWidget('calc', 3, 5)">Calculator</button>
        <button class="btn" onclick="Dashboard.addWidget('calendar', 4, 4)">Calendar</button>
        <button class="btn" onclick="Dashboard.addWidget('weather', 3, 3)">Weather</button>
        <button class="btn" onclick="Dashboard.addWidget('converter', 3, 4)">Converter</button>
        <button class="btn" onclick="Dashboard.addWidget('stopwatch', 3, 3)">Stopwatch</button>
        <button class="btn" onclick="Dashboard.addWidget('battery', 3, 2)">Battery</button>
        <button class="btn" onclick="Dashboard.addWidget('passgen', 4, 3)">Password</button>
        <button class="btn btn-danger" onclick="toggleAddPanel(false)">Close</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all.js"></script>
    
    <script>
        const WidgetLogic = {
            startTimer: (id) => {
                const inp = document.getElementById(id + '-input');
                const disp = document.getElementById(id + '-disp');
                let time = parseInt(inp.value) * 60;
                if(isNaN(time)) return;
                
                if(window[id+'_interval']) clearInterval(window[id+'_interval']);
                window[id+'_interval'] = setInterval(() => {
                    time--;
                    let m = Math.floor(time / 60);
                    let s = time % 60;
                    disp.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                    if(time <= 0) { clearInterval(window[id+'_interval']); alert("Timer Finished!"); }
                }, 1000);
            },
            calc: (id, val) => {
                const screen = document.getElementById(id + '-screen');
                if(val === '=') try { screen.value = eval(screen.value); } catch { screen.value = "Error"; }
                else if(val === 'C') screen.value = '';
                else screen.value += val;
            },
            genPass: (id) => {
                const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
                let pass = "";
                for(let i=0; i<16; i++) pass += chars.charAt(Math.floor(Math.random() * chars.length));
                document.getElementById(id + '-pass').value = pass;
            },
            convert: (id) => {
                const val = parseFloat(document.getElementById(id + '-val').value);
                const type = document.getElementById(id + '-type').value;
                const res = document.getElementById(id + '-res');
                if(isNaN(val)) return;
                let converted = 0;
                if(type === 'c-f') converted = (val * 9/5) + 32 + "°F";
                if(type === 'kg-lb') converted = (val * 2.20462).toFixed(2) + " lbs";
                if(type === 'm-ft') converted = (val * 3.28084).toFixed(2) + " ft";
                res.innerText = converted;
            }
        };

        const Dashboard = (() => {
            let grid = null;
            let isEditing = false;

            const init = () => {
                grid = GridStack.init({ column: 12, cellHeight: '90px', margin: 15, animate: true, float: true });
                loadInitialState();
                setInterval(updateGlobalWidgets, 5000);
            };

            const updateGlobalWidgets = () => {
                // Update Battery
                if(navigator.getBattery) {
                    navigator.getBattery().then(batt => {
                        const bEls = document.querySelectorAll('.batt-disp');
                        bEls.forEach(el => {
                            el.innerText = Math.floor(batt.level * 100) + "%" + (batt.charging ? " ⚡" : "");
                        });
                    });
                }
            };

            const toggleEdit = () => {
                isEditing = !isEditing;
                grid.enableMove(isEditing); grid.enableResize(isEditing);
                document.getElementById('dashboard-wrapper').classList.toggle('editing', isEditing);
                document.getElementById('edit-mode-btn').innerHTML = isEditing ? '<i class="fa fa-check"></i> Done' : '<i class="fa fa-pencil"></i> Customize';
                if (!isEditing) saveState();
            };

            const addWidget = (type, w, h, x, y, data) => {
                const id = 'w-' + Math.random().toString(36).substr(2, 9);
                const el = grid.addWidget({ w, h, x, y, content: getTemplate(type, id) });
                el.querySelector('.remove-widget').onclick = () => grid.removeWidget(el);

                if (type === 'clock') startClock(id);
                if (type === 'weather') initWeather(id);
                if (type === 'calendar') initCalendar(id);
                toggleAddPanel(false);
                saveState();
            };

            const getTemplate = (type, id) => {
                const header = `<div class="remove-widget">✕</div><span class="w-label">${type}</span>`;
                const templates = {
                    clock: `<div class="widget-clock" id="${id}">${header}<div class="time-display">00:00</div><div class="date-display">...</div></div>`,
                    timer: `<div id="${id}">${header}<input type="number" id="${id}-input" placeholder="Minutes"><button class="btn-primary btn" onclick="WidgetLogic.startTimer('${id}')">Start</button><div class="widget-val" id="${id}-disp">00:00</div></div>`,
                    calc: `<div id="${id}">${header}<input id="${id}-screen" readonly><div class="calc-grid">` + 
                          ['7','8','9','/','4','5','6','*','1','2','3','-','C','0','=','+'].map(k => `<button class="calc-btn" onclick="WidgetLogic.calc('${id}','${k}')">${k}</button>`).join('') + `</div></div>`,
                    calendar: `<div id="${id}">${header}<div class="cal-grid" id="${id}-cal"></div></div>`,
                    weather: `<div id="${id}">${header}<div class="widget-val" id="${id}-temp">--°C</div><div id="${id}-loc" style="font-size:12px; color:var(--text-secondary)">Detecting...</div></div>`,
                    converter: `<div id="${id}">${header}<input type="number" id="${id}-val" oninput="WidgetLogic.convert('${id}')" placeholder="Value"><select id="${id}-type" onchange="WidgetLogic.convert('${id}')"><option value="c-f">C to F</option><option value="kg-lb">Kg to Lb</option><option value="m-ft">M to Ft</option></select><div class="widget-val" style="font-size:20px" id="${id}-res">Result</div></div>`,
                    stopwatch: `<div id="${id}">${header}<div class="widget-val" id="${id}-sw">00:00.0</div><button class="btn" onclick="window['s_'+'${id}']=Date.now(); window['i_'+'${id}']=setInterval(()=>{let d=new Date(Date.now()-window['s_'+'${id}']); document.getElementById('${id}-sw').innerText=d.toISOString().substr(14,7)},100)">Start</button><button class="btn" onclick="clearInterval(window['i_'+'${id}'])">Stop</button></div>`,
                    battery: `<div id="${id}">${header}<div class="widget-val batt-disp">--%</div></div>`,
                    passgen: `<div id="${id}">${header}<input id="${id}-pass" readonly placeholder="Click Gen"><button class="btn btn-primary" onclick="WidgetLogic.genPass('${id}')">Generate 16-Digit</button></div>`,
                    todo: `<div class="widget-todo" id="${id}">${header}<input type="text" class="todo-input" placeholder="Add..."><div class="todo-list"></div></div>`,
                    notes: `<div class="widget-notes" id="${id}">${header}<textarea class="note-area" style="background:transparent; border:none; color:#ddd; width:100%; height:80px; outline:none; resize:none;" placeholder="Write thoughts..."></textarea></div>`
                };
                return templates[type];
            };

            const startClock = (id) => setInterval(() => {
                const el = document.getElementById(id); if(!el) return;
                const d = new Date();
                el.querySelector('.time-display').innerText = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
                el.querySelector('.date-display').innerText = d.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
            }, 1000);

            const initWeather = (id) => {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`)
                    .then(r => r.json()).then(data => {
                        document.getElementById(id + '-temp').innerText = Math.round(data.current_weather.temperature) + '°C';
                        document.getElementById(id + '-loc').innerText = "Local Weather";
                    });
                });
            };

            const initCalendar = (id) => {
                const now = new Date();
                const gridEl = document.getElementById(id + '-cal');
                const days = ['S','M','T','W','T','F','S'];
                let html = days.map(d => `<div class="cal-day-head">${d}</div>`).join('');
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1).getDay();
                const totalDays = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
                for(let i=0; i<firstDay; i++) html += '<div></div>';
                for(let i=1; i<=totalDays; i++) html += `<div class="${i===now.getDate()?'cal-today':''}">${i}</div>`;
                gridEl.innerHTML = html;
            };

            const saveState = () => {
                const data = grid.getGridItems().map(el => {
                    const type = el.querySelector('.w-label').innerText.toLowerCase();
                    return { w: el.gridstackNode.w, h: el.gridstackNode.h, x: el.gridstackNode.x, y: el.gridstackNode.y, type };
                });
                localStorage.setItem('ss_ultra_v5', JSON.stringify(data));
            };

            const loadInitialState = () => {
                const saved = JSON.parse(localStorage.getItem('ss_ultra_v5'));
                if (saved) saved.forEach(w => addWidget(w.type, w.w, w.h, w.x, w.y));
                else { addWidget('clock', 4, 3, 0, 0); addWidget('weather', 3, 3, 4, 0); }
            };

            return { init, toggleEdit, addWidget, saveState, clearState: () => {localStorage.removeItem('ss_ultra_v5'); location.reload();}, isEditingMode: () => isEditing };
        })();

        function toggleAddPanel(f) { document.getElementById('add-panel').classList.toggle('show', f); }
        window.onload = Dashboard.init;
    </script>
</body>
</html>
